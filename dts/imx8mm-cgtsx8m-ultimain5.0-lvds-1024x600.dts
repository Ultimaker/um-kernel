/*
 * Copyright (C) 2020 - Ultimaker B.V.
 * Copyright (C) 2020 - Raymond Siudak <raysiudak@gmail.com>
*/

/dts-v1/;

#include "congatec/imx8mm-cgtsx8m.dts"
#include "ulticontroller4.0.dtsi"

/* See Documentation/devicetree/bindings/video/display-timing.txt */
/* HX8282-A11 1024x600@60Hz */
&i2c4 {
    /* DSI-LVDS bridge */
    lvdsbridge: sn65dsi84@2c {
        status = "okay";

        /delete-property/ lvds,use-uboot-settings; // will get replaced by dp props

        /* LVDS 1024x600@60Hz pixclock 51.2MHz*/
        lvds,pixelclock = <51206400>;
        lvds,hactive = <1024>;
        lvds,vactive = <600>;
        lvds,hfront_porch = <160>;
        lvds,hback_porch = <160>;
        lvds,hsync_len = <10>; // Must be more then 1, number does not matter
        lvds,vfront_porch = <12>;
        lvds,vback_porch = <23>;
        lvds,vsync_len = <10>; // Must be more then 1, number does not matter
        lvds,color_depth = "rgb24";
        lvds,hsync_pol = <0>;
        lvds,vsync_pol = <0>;
        lvds,datamap = "spwg";
    };
};


/* GPIO PAD setting */
/* 0x1C0 -- pull-up,   HYST, no-OD, slow, X1 */
/* 0x140 -- pull-up,   CMOS, no-OD, slow, X1 */
/* 0x100 -- pull-down, CMOS, no-OD, slow, X1 */
/* 0x080 -- pull-off,  HYST, no-OD, slow, X1 */
/* 0x000 -- pull-off,  CMOS, no-OD, slow, X1 */

/* Redefine pinctrl settings for GPIOs to be re-purposed. */
&pinctrl_gpio1 {
    fsl,pins = <
        MX8MM_IOMUXC_GPIO1_IO07_GPIO1_IO7       0x140 /* GPIO0 / CSI0 PWR */
        MX8MM_IOMUXC_GPIO1_IO15_GPIO1_IO15      0x140 /* TEST# */
    >;
};

/* Redefine pinctrl settings for GPIOs to be re-purposed. */
&pinctrl_gpio5 {
    fsl,pins = <
        MX8MM_IOMUXC_SPDIF_RX_GPIO5_IO4         0x140 /* GPIO5 / PWMOUT */
    >;
};

/* Re-purpose, used for led driver. */
&iomuxc {
    led {
        pinctrl_leds_1: ledsgrp-1 {
            fsl,pins = <
                MX8MM_IOMUXC_SPDIF_TX_GPIO5_IO3         0x100 /* GPIO1 / CSI1 PWR */
                MX8MM_IOMUXC_SPDIF_EXT_CLK_GPIO5_IO5    0x100 /* GPIO3 / CSI1 RST */
                MX8MM_IOMUXC_GPIO1_IO06_GPIO1_IO6       0x100 /* GPIO2 / CSI0 RST */
            >;
        };
    };
};

/ {
    leds {
        compatible = "gpio-leds";
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_leds_1>;

        led0 {
            label = "som:red:carrier-led0";
            gpios = <&gpio5 5 GPIO_ACTIVE_HIGH>;
            linux,default-trigger = "heartbeat";
            default-state = "keep";
        };

        led1 {
            label = "som:red:carrier-led1";
            gpios = <&gpio5 3 GPIO_ACTIVE_HIGH>;
            linux,default-trigger = "none";
            default-state = "keep";
        };

        led2 {
            label = "som:red:carrier-sd-led";
            gpios = <&gpio1 6 GPIO_ACTIVE_HIGH>;
            linux,default-trigger = "mmc1";
            default-state = "keep";
		};
	};
};

